<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stories Of Us — worldwide disability content</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    body{margin:0;background:#111;color:#f2f2f2;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    .header{display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap}
    .social{display:flex;gap:12px}
    .social img{width:28px;height:28px}
    .actions{display:flex;gap:12px;flex-wrap:wrap;justify-content:flex-end}
    .btn{border:2px solid #fff;border-radius:20px;padding:8px 14px;background:transparent;color:#fff;font-weight:700}
    .hero{display:flex;align-items:center;justify-content:center;margin:12px 0 16px}
    .hero img{max-width:360px;width:100%;height:auto}
    .tabs{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:14px 0}
    .tabs button{border:2px solid #fff;border-radius:24px;padding:8px 14px;background:#111;color:#fff;font-weight:800}
    .tabs button.active{background:#fff;color:#000}
    .status{max-width:1200px;margin:16px auto;border:2px dotted #999;border-radius:12px;color:#000;background:#f4f4f4;padding:8px 12px}
    .cards{max-width:1200px;margin:16px auto;display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));padding:0 16px 32px}
    .card{background:#fff;color:#111;border:2px solid #000;border-radius:16px;overflow:hidden;display:flex;flex-direction:column;min-height:260px}
    .card .media{height:140px;background:#ddd}
    .card .media img{width:100%;height:100%;object-fit:cover;display:block}
    .card .content{padding:12px 12px 8px}
    .cat-label{font-size:.85rem;text-transform:uppercase;letter-spacing:.04em;color:#555;margin-bottom:4px}
    .card h3{margin:0 0 6px;font-size:1rem}
    .meta{color:#666;font-size:.85rem;margin:4px 0}
    .drawer{border-top:1px solid #ccc;padding:10px 12px 12px;margin-top:4px;background:#fafafa;display:none}
    .card.expanded .drawer{display:block}
    .drawer p{margin:0 0 10px}
    .drawer .buttons{display:flex;gap:8px;flex-wrap:wrap}
    .drawer button{border-radius:18px;border:1px solid #333;padding:6px 10px;font-size:.9rem;cursor:pointer}
    .drawer button.primary{background:#111;color:#fff}
    @media (min-width:900px){
      .tabs{flex-wrap:nowrap}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="social">
        <a aria-label="Facebook"  href="#" target="_blank" rel="noopener"><img src="assets/icons/facebook_icon.svg" alt=""></a>
        <a aria-label="Instagram" href="#" target="_blank" rel="noopener"><img src="assets/icons/instagram_icon.svg" alt=""></a>
        <a aria-label="X (Twitter)" href="#" target="_blank" rel="noopener"><img src="assets/icons/x_icon.svg" alt=""></a>
        <a aria-label="YouTube"   href="#" target="_blank" rel="noopener"><img src="assets/icons/youtube_icon.svg" alt=""></a>
      </div>
      <div class="actions">
        <button class="btn" id="aboutBtn">About</button>
        <button class="btn" id="textOnlyBtn" aria-pressed="false">Text Only</button>
        <button class="btn" id="contrastBtn" aria-pressed="false">High Contrast</button>
      </div>
    </div>

    <div class="hero">
      <img src="assets/brand/storiesofus_logo.svg" alt="Stories Of Us — worldwide disability content">
    </div>

    <div class="tabs" role="tablist" aria-label="Content categories">
      <button class="active" data-tab="latest" role="tab" aria-selected="true">Latest</button>
      <button data-tab="Access" role="tab" aria-selected="false">Access</button>
      <button data-tab="Tech" role="tab" aria-selected="false">Tech</button>
      <button data-tab="Activism" role="tab" aria-selected="false">Activism</button>
      <button data-tab="History" role="tab" aria-selected="false">History</button>
      <button data-tab="Arts" role="tab" aria-selected="false">Arts</button>
      <button data-tab="General" role="tab" aria-selected="false">General</button>
    </div>
  </div>

  <div class="status" id="status">Loading…</div>
  <div class="cards" id="cards"></div>

  <script>
  (function(){
    const statusEl = document.getElementById('status');
    const cardsEl  = document.getElementById('cards');

    const CANDIDATES = [
      '/assets/feeds/sample_all.json',
      'assets/feeds/sample_all.json',
      '/feeds/sample_all.json',
      'feeds/sample_all.json'
    ];

    async function loadJSON(){
      for (const url of CANDIDATES){
        try {
          const r = await fetch(url, {cache: 'no-store'});
          if (r.ok) {
            statusEl.textContent = 'Loaded data from: ' + url;
            return await r.json();
          }
        } catch(e){}
      }
      throw new Error('Could not find feeds/sample_all.json in expected locations.');
    }

    function normalizeStories(data){
      const arr = Array.isArray(data) ? data : (data.stories || []);
      return arr.map(s => ({
        title: s.title || s.headline || '(untitled)',
        url:   s.url || s.link || '#',
        image: s.image || s.thumbnail || '',
        published: s.published || s.date || '',
        source: s.source || '',
        region: s.region || '',
        category: s.category || '',
        summary: s.summary || ''
      }));
    }

    function cardTemplate(s, index){
      const img = s.image ? `<img src="${s.image}" alt="">`
                          : `<img src="assets/placeholders/placeholder.svg" alt="">`;
      const date = s.published ? new Date(s.published).toLocaleString() : '';
      const cat  = s.category || 'Latest';
      const summary = s.summary || 'Open the full article to read more on the source site.';
      return `
        <article class="card" data-index="${index}">
          <a href="${s.url}" target="_blank" rel="noopener" class="card-link">
            <div class="media">${img}</div>
            <div class="content">
              <div class="cat-label">${cat}</div>
              <h3>${s.title}</h3>
              <p class="meta">${s.source || ''}${date ? ' • ' + date : ''}</p>
            </div>
          </a>
          <div class="drawer">
            <p>${summary}</p>
            <div class="buttons">
              <button class="primary" type="button" data-action="open-external">Read full article</button>
              <button type="button" data-action="close">Close</button>
            </div>
          </div>
        </article>
      `;
    }

    let ALL = [];

    function render(list){
      cardsEl.innerHTML = list.map(cardTemplate).join('');
    }

    // Tabs
    const tabs = Array.from(document.querySelectorAll('.tabs [role="tab"]'));
    tabs.forEach(btn => {
      btn.addEventListener('click', () => {
        tabs.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const key = btn.dataset.tab;
        if (key === 'latest'){
          render(ALL);
        } else {
          const subset = ALL.filter(s => (s.category || '').toLowerCase() === key.toLowerCase());
          render(subset.length ? subset : []);
        }
      });
    });

    // Drawer behavior (event delegation)
    cardsEl.addEventListener('click', e => {
      const btn = e.target.closest('button[data-action]');
      const cardEl = e.target.closest('.card');
      if (!cardEl) return;

      const idx = parseInt(cardEl.getAttribute('data-index'), 10);
      const story = ALL[idx];

      if (btn){
        const action = btn.getAttribute('data-action');
        if (action === 'open-external' && story && story.url){
          window.open(story.url, '_blank', 'noopener');
        }
        if (action === 'close'){
          cardEl.classList.remove('expanded');
        }
        e.preventDefault();
        e.stopPropagation();
        return;
      }

      // Clicking the card (outside buttons) toggles drawer
      cardEl.classList.toggle('expanded');
      e.preventDefault();
    });

    loadJSON()
      .then(json => {
        const stories = normalizeStories(json);
        stories.sort((a,b)=> (new Date(b.published||0)) - (new Date(a.published||0)));
        ALL = stories;
        render(ALL);
      })
      .catch(err => {
        statusEl.textContent = err.message;
        console.error(err);
      });

    // Simple theme toggles (reuse your previous behavior)
    const html = document.documentElement;
    const contrastBtn = document.getElementById('contrastBtn');
    const textOnlyBtn = document.getElementById('textOnlyBtn');
    function applyState(){
      const hc = localStorage.getItem('theme-contrast') === '1';
      const to = localStorage.getItem('mode-textonly') === '1';
      html.classList.toggle('theme-contrast', hc);
      html.classList.toggle('mode-textonly', to);
      contrastBtn.setAttribute('aria-pressed', String(hc));
      textOnlyBtn.setAttribute('aria-pressed', String(to));
    }
    contrastBtn.addEventListener('click', ()=>{ localStorage.setItem('theme-contrast', html.classList.toggle('theme-contrast') ? '1':'0'); applyState();});
    textOnlyBtn.addEventListener('click', ()=>{ localStorage.setItem('mode-textonly', html.classList.toggle('mode-textonly') ? '1':'0'); applyState();});
    applyState();
  })();
  </script>
</body>
</html>
