<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stories Of Us — worldwide disability content</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* small safety styles so layout looks OK even if your main CSS changes */
    body{margin:0;background:#111;color:#f2f2f2;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .social{display:flex;gap:12px}
    .social img{width:28px;height:28px}
    .hero{display:flex;align-items:center;justify-content:center;margin:12px 0 16px}
    .hero img{max-width:100%;height:auto}
    .actions{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin:8px 0 12px}
    .btn{border:2px solid #fff;border-radius:20px;padding:8px 14px;background:transparent;color:#fff;font-weight:700}
    .tabs{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:14px 0}
    .tabs button{border:2px solid #fff;border-radius:24px;padding:8px 14px;background:#111;color:#fff;font-weight:800}
    .tabs button.active{background:#fff;color:#000}
    .status{max-width:1200px;margin:16px auto;border:2px dotted #999;border-radius:12px;color:#000;background:#f4f4f4;padding:12px}
    .cards{max-width:1200px;margin:16px auto;display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));padding:0 16px 32px}
    .card{background:#fff;color:#111;border:2px solid #000;border-radius:16px;overflow:hidden}
    .card .media{height:160px;background:#ddd}
    .card .media img{width:100%;height:100%;object-fit:cover;display:block}
    .card .content{padding:12px}
    .meta{color:#666;font-size:.9rem;margin-top:6px}
    a{color:inherit;text-decoration:none}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- top bar -->
    <div class="header">
      <div class="social">
        <a aria-label="Facebook"  href="#" target="_blank" rel="noopener"><img src="assets/icons/facebook_icon.svg" alt=""></a>
        <a aria-label="Instagram" href="#" target="_blank" rel="noopener"><img src="assets/icons/instagram_icon.svg" alt=""></a>
        <a aria-label="X (Twitter)" href="#" target="_blank" rel="noopener"><img src="assets/icons/x_icon.svg" alt=""></a>
        <a aria-label="YouTube"   href="#" target="_blank" rel="noopener"><img src="assets/icons/youtube_icon.svg" alt=""></a>
      </div>
      <div class="actions">
        <button class="btn" id="aboutBtn">About</button>
        <button class="btn" id="textOnlyBtn" aria-pressed="false">Text Only</button>
        <button class="btn" id="contrastBtn" aria-pressed="false">High Contrast</button>
      </div>
    </div>

    <!-- hero -->
    <div class="hero">
      <img src="assets/brand/storiesofus_logo.svg" alt="Stories Of Us — worldwide disability content">
    </div>

    <!-- tabs -->
    <div class="tabs" role="tablist" aria-label="Content categories">
      <button class="active" data-tab="latest" role="tab" aria-selected="true">Latest</button>
      <button data-tab="Access" role="tab" aria-selected="false">Access</button>
      <button data-tab="Tech" role="tab" aria-selected="false">Tech</button>
      <button data-tab="Activism" role="tab" aria-selected="false">Activism</button>
      <button data-tab="History" role="tab" aria-selected="false">History</button>
      <button data-tab="Arts" role="tab" aria-selected="false">Arts</button>
      <button data-tab="General" role="tab" aria-selected="false">General</button>
    </div>
  </div>

  <div class="status" id="status">Loading…</div>
  <div class="cards" id="cards"></div>

  <script>
  (function(){
    const statusEl = document.getElementById('status');
    const cardsEl  = document.getElementById('cards');

    // Try a few safe paths. First one should work with your repo layout.
    const CANDIDATES = [
      '/assets/feeds/sample_all.json',
      'assets/feeds/sample_all.json',
      '/feeds/sample_all.json',
      'feeds/sample_all.json'
    ];

    async function loadJSON(){
      for (const url of CANDIDATES){
        try {
          const r = await fetch(url, {cache: 'no-store'});
          if (r.ok) {
            statusEl.textContent = 'Loaded data from: ' + url;
            return await r.json();
          }
        } catch(e){}
      }
      throw new Error('Could not find feeds/sample_all.json in expected locations.');
    }

    function normalizeStories(data){
      // Accept both {stories:[...]} and a bare array
      const arr = Array.isArray(data) ? data : (data.stories || []);
      return arr.map(s => ({
        title: s.title || s.headline || '(untitled)',
        url:   s.url || s.link || '#',
        image: s.image || s.thumbnail || '',
        published: s.published || s.date || '',
        source: s.source || '',
        category: s.category || '' // may be empty
      }));
    }

    function cardTemplate(s){
      const img = s.image ? `<img src="${s.image}" alt="">`
                          : `<img src="assets/placeholders/placeholder.svg" alt="">`;
      const date = s.published ? new Date(s.published).toLocaleString() : '';
      return `
        <article class="card">
          <a href="${s.url}" target="_blank" rel="noopener">
            <div class="media">${img}</div>
            <div class="content">
              <div class="meta">${s.category || 'Latest'}</div>
              <h3>${s.title}</h3>
              <p class="meta">${s.source || ''}${date ? ' • ' + date : ''}</p>
            </div>
          </a>
        </article>
      `;
    }

    function render(list){ cardsEl.innerHTML = list.map(cardTemplate).join(''); }

    // Tab handling
    const tabs = Array.from(document.querySelectorAll('.tabs [role="tab"]'));
    let ALL = [];

    tabs.forEach(btn => {
      btn.addEventListener('click', () => {
        tabs.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const key = btn.dataset.tab;
        if (key === 'latest'){
          render(ALL);
        } else {
          // If items have no category, still show them under Latest only.
          const subset = ALL.filter(s => (s.category || '').toLowerCase() === key.toLowerCase());
          render(subset.length ? subset : []);
        }
      });
    });

    // load + render
    loadJSON()
      .then(json => {
        const stories = normalizeStories(json);
        // newest first
        stories.sort((a,b)=> (new Date(b.published||0)) - (new Date(a.published||0)));
        ALL = stories;
        render(ALL);
      })
      .catch(err => {
        statusEl.textContent = err.message;
        console.error(err);
      });

    // accessibility toggles (simple persistence)
    const html = document.documentElement;
    const contrastBtn = document.getElementById('contrastBtn');
    const textOnlyBtn = document.getElementById('textOnlyBtn');
    function applyState(){
      const hc = localStorage.getItem('theme-contrast') === '1';
      const to = localStorage.getItem('mode-textonly') === '1';
      html.classList.toggle('theme-contrast', hc);
      html.classList.toggle('mode-textonly', to);
      contrastBtn.setAttribute('aria-pressed', String(hc));
      textOnlyBtn.setAttribute('aria-pressed', String(to));
    }
    contrastBtn.addEventListener('click', ()=>{ localStorage.setItem('theme-contrast', html.classList.toggle('theme-contrast') ? '1':'0'); applyState();});
    textOnlyBtn.addEventListener('click', ()=>{ localStorage.setItem('mode-textonly', html.classList.toggle('mode-textonly') ? '1':'0'); applyState();});
    applyState();
  })();
  </script>
</body>
</html>
